#!/usr/bin/env bash

source project.conf

CORE_SERVICE_NAME=$(basename $GAME_SERVICE_BINARY)

FILES="\
source/upstart/$CORE_SERVICE_NAME.conf \
$GAME_SERVICE_BINARY \
$CLIENT_ARCHIVE \
source/nginx/vndf.de \
source/http/index.html"

COMMANDS="
mkdir -p /opt/vndf
mv -f $CORE_SERVICE_NAME /opt/vndf
mv -f $CORE_SERVICE_NAME.conf /etc/init

mv -f vndf.de /etc/nginx/sites-available
rm -f /etc/nginx/sites-enabled/vndf.de
ln -s /etc/nginx/sites-available/vndf.de /etc/nginx/sites-enabled/vndf.de

mkdir -p /srv/http/vndf.de

mv -f $(basename $CLIENT_ARCHIVE) /srv/http/vndf.de
mv -f index.html /srv/http/vndf.de

service nginx restart
restart --quiet $CORE_SERVICE_NAME"

./scripts/tasks/build-game-service &&
./scripts/tasks/build-client &&
./scripts/tasks/arrange-client &&
./scripts/tasks/package-client &&
./scripts/tools/deploy "$FILES" "$COMMANDS" $SERVER_ADDRESS
