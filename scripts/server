#!/usr/bin/env bash

source project.conf

SOURCE_FILES="\
source/server/main.c \
source/server/net.c \
source/server/clients.c \
source/common/vec.c"

HEADER_FILES=$(find source/server source/common -name "*.h")

BINARY=$OUTPUT_DIR/$CORE_SERVICE

function updateServer() {
	./scripts/zwobot/zwobot-compile "$SOURCE_FILES" "" "" $BINARY

	killall $CORE_SERVICE

	./$BINARY &
	PID=$!
}

updateServer
while true
do
	inotifywait -qq -e modify $SOURCE_FILES $HEADER_FILES
	echo "Change detected."
	updateServer
done
