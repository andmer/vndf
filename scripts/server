#!/usr/bin/env bash

source project.conf

SOURCE_FILES=$(find $CORE_SERVICE_SOURCE -name "*.c")
HEADER_FILES=$(find $CORE_SERVICE_SOURCE -name "*.h")
RUST_FILES=$(find $CORE_SERVICE_SOURCE -name "*.rs")

function updateServer() {
	./scripts/tasks/build-core-service
	killall $(basename $CORE_SERVICE_BINARY)
	./$CORE_SERVICE_BINARY &
}

updateServer
while true
do
	inotifywait -qq -e modify $SOURCE_FILES $HEADER_FILES $RUST_FILES
	echo -e "Change detected.\n\n\n"
	updateServer
done
