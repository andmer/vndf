#!/usr/bin/env bash

source project.conf

OUTPUT_LIB_RUST=$OUTPUT_LIB/rust
mkdir -p $OUTPUT_LIB_RUST

function build-rust() {
	RUST_SOURCE=$1

	rustc -L $OUTPUT_LIB_RUST -o $OUTPUT_LIB_RUST/lib $RUST_SOURCE
}

build-rust source/rust/common/main.rs
build-rust source/rust/core-service/clients.rs
build-rust source/rust/core-service/net.rs
build-rust source/rust/core-service/protocol.rs
build-rust source/rust/core-service/events.rs

RUST_LIBS="$(find $OUTPUT_LIB_RUST -name *.a)"

./scripts/zwobot/zwobot-compile \
	"$CORE_SERVICE_SOURCE" \
	"$RUST_LIBS" \
	"-lm -lrt -ldl -lpthread -lstdc++" \
	$CORE_SERVICE_BINARY
