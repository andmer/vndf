#!/usr/bin/env bash

source project.conf

mkdir -p $CLIENT_DIST_DIR
mkdir -p $OUTPUT_LIB_RUST

./scripts/tools/compile-rust \
	$RUSTC \
	"-L $OUTPUT_LIB_RUST" \
	"--out-dir $OUTPUT_LIB_RUST" \
	source/rust/common/main.rs &&
./scripts/tools/compile-rust \
	$RUSTC \
	"-L $OUTPUT_LIB_RUST" \
	"-o $CLIENT_DIST_DIR/vndf-client-core" \
	source/rust/client-core/main.rs &&
./scripts/tools/compile-rust \
	$RUSTC \
	"-L $OUTPUT_LIB_RUST -L $OUTPUT_LIB" \
	"-o $CLIENT_BINARY" \
	source/rust/client/main.rs

if [ $? -ne 0 ]; then
	exit 1
fi

RUST_LIBS=$(find $OUTPUT_LIB_RUST -name *.a)

(rm -f $CLIENT_DIST_DIR/fonts;
	ln -s $(pwd)/source/fonts $CLIENT_DIST_DIR/fonts) &&
(rm -f $CLIENT_DIST_DIR/images;
	ln -s $(pwd)/source/images $CLIENT_DIST_DIR/images) &&
cp -r source/config/server $CLIENT_DIST_DIR
